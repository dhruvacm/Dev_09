<!DOCTYPE html>
<html>
<head>
  <title>Notifications</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Elegant Font -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    body {
      background: linear-gradient(to bottom right, #f4f8ff, #e6f0ff);
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
    }

    .brand-title {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      letter-spacing: 1px;
      color: #2c3e50;
    }

    .header-bar {
      background: #ffffff;
      border-radius: 12px;
    }

    .notification-card {
      background-color: #eaf4ff;
      border-radius: 14px;
      transition: 0.3s ease;
    }

    .notification-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }
  </style>
</head>

<body>

<div class="container py-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4 p-3 shadow-sm header-bar">
    <h3 class="m-0 brand-title">Emotion Community</h3>
    <a href="dashboard.html" class="btn btn-outline-secondary btn-sm">Back</a>
  </div>

  <h5 class="mb-3 text-muted">Your Notifications</h5>

  <div id="notificationList"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, getDocs, query, updateDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDbJ2WrjZD5KpYirppactc1eOFNnsdG5Dg",
  authDomain: "emotion-community-app.firebaseapp.com",
  projectId: "emotion-community-app",
  storageBucket: "emotion-community-app.firebasestorage.app",
  messagingSenderId: "684942590421",
  appId: "1:684942590421:web:0e4dd3b50450f19ee4fd5c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  const q = query(collection(db, "notifications"));
  const snapshot = await getDocs(q);

  const list = document.getElementById("notificationList");
  list.innerHTML = "";

  let hasNotifications = false;

  for (const docSnap of snapshot.docs) {
    const data = docSnap.data();

    if (data.userId === user.uid) {
      hasNotifications = true;

      list.innerHTML += `
        <div class="card notification-card p-3 mb-3 shadow-sm border-0">
          <p class="mb-1">${data.message}</p>
          <small class="text-muted">
            Post: ${data.postPreview || "Content unavailable"}
          </small>
        </div>
      `;

      // Mark as read
      await updateDoc(doc(db, "notifications", docSnap.id), {
        read: true
      });
    }
  }

  if (!hasNotifications) {
    list.innerHTML = `
      <div class="text-muted">No notifications yet.</div>
    `;
  }
});
</script>

</body>
</html>