<!DOCTYPE html>
<html>
<head>
  <title>Create Post</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Elegant Font -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    body {
      background: linear-gradient(to bottom right, #f4f8ff, #e6f0ff);
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
    }

    .brand-title {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      letter-spacing: 1px;
      color: #2c3e50;
    }

    .post-card {
      border-radius: 16px;
      border: none;
    }

    .btn-theme {
      background-color: #4a90e2;
      border: none;
      color: white;
    }

    .btn-theme:hover {
      background-color: #3a7bd5;
    }

    .form-control, .form-select {
      border-radius: 10px;
    }

    .header-bar {
      background: #ffffff;
      border-radius: 12px;
    }
  </style>
</head>

<body>

<div class="container py-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4 p-3 shadow-sm header-bar">
    <h3 class="m-0 brand-title">Emotion Community</h3>
    <a href="dashboard.html" class="btn btn-outline-secondary btn-sm">Back</a>
  </div>

  <!-- Post Form -->
  <div class="card post-card shadow-sm p-4">

    <h5 class="mb-3 text-muted">Create New Post</h5>

    <textarea id="postText"
      class="form-control mb-3"
      placeholder="Share your feelings..."
      rows="4"></textarea>

    <select id="emotion" class="form-select mb-3">
      <option value="">Select Emotion</option>
      <option>Happy</option>
      <option>Sad</option>
      <option>Frustrated</option>
      <option>Excited</option>
    </select>

    <select id="category" class="form-select mb-4">
      <option value="">Select Category</option>
      <option>College</option>
      <option>Relationships</option>
      <option>Work</option>
      <option>Family</option>
    </select>

    <button class="btn btn-theme w-100" onclick="addPost()">Post</button>

  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDbJ2WrjZD5KpYirppactc1eOFNnsdG5Dg",
  authDomain: "emotion-community-app.firebaseapp.com",
  projectId: "emotion-community-app",
  storageBucket: "emotion-community-app.firebasestorage.app",
  messagingSenderId: "684942590421",
  appId: "1:684942590421:web:0e4dd3b50450f19ee4fd5c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login.html";
  }
});

window.addPost = async function () {
  const text = document.getElementById("postText").value;
  const emotion = document.getElementById("emotion").value;
  const category = document.getElementById("category").value;

  if (!text || !emotion || !category) {
    alert("Fill all fields");
    return;
  }

  await addDoc(collection(db, "posts"), {
    text,
    emotion,
    category,
    userId: auth.currentUser.uid,
    createdAt: serverTimestamp(),
    likes: 0,
    love: 0,
    sad: 0
  });

  window.location.href = "dashboard.html";
};
</script>

</body>
</html>