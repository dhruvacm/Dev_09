<!DOCTYPE html>
<html>
<head>
  <title>Profile</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Elegant Font -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    body {
      background: linear-gradient(to bottom right, #f4f8ff, #e6f0ff);
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
    }

    .brand-title {
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      letter-spacing: 1px;
      color: #2c3e50;
    }

    .header-bar {
      background: #ffffff;
      border-radius: 12px;
    }

    .stat-card {
      border-radius: 14px;
      background-color: #ffffff;
    }

    .post-card {
      background-color: #eaf4ff;
      border-radius: 14px;
    }

    .post-card:hover {
      transform: translateY(-3px);
      transition: 0.3s ease;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }
  </style>
</head>

<body>

<div class="container py-4">

  <!-- Header -->
 <div class="d-flex justify-content-between align-items-center mb-4 p-3 shadow-sm header-bar">
  <h3 class="m-0 brand-title">Emotion Community</h3>

  <div>
    <a href="dashboard.html" class="btn btn-outline-secondary btn-sm me-2">Back</a>
    <button class="btn btn-outline-danger btn-sm" onclick="logout()">Logout</button>
  </div>
</div>

  <!-- Profile Info -->
  <div class="card stat-card shadow-sm p-4 mb-4">
    <h5 class="mb-3">Your Profile</h5>

    <p class="mb-2">
      <strong>Email:</strong>
      <span id="userEmail"></span>
    </p>

    <div class="row mt-3">
      <div class="col-md-6 mb-3">
        <div class="card stat-card p-3 text-center shadow-sm">
          <h6 class="text-muted">Total Posts</h6>
          <h4 id="postCount" class="fw-bold">0</h4>
        </div>
      </div>

      <div class="col-md-6 mb-3">
        <div class="card stat-card p-3 text-center shadow-sm">
          <h6 class="text-muted">Total Reactions</h6>
          <h4 id="reactionCount" class="fw-bold">0</h4>
        </div>
      </div>
    </div>
  </div>

  <!-- User Posts -->
  <h5 class="mb-3 text-muted">Your Posts</h5>
  <div id="userPosts"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDbJ2WrjZD5KpYirppactc1eOFNnsdG5Dg",
  authDomain: "emotion-community-app.firebaseapp.com",
  projectId: "emotion-community-app",
  storageBucket: "emotion-community-app.firebasestorage.app",
  messagingSenderId: "684942590421",
  appId: "1:684942590421:web:0e4dd3b50450f19ee4fd5c"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  document.getElementById("userEmail").innerText = user.email;

  const postsSnapshot = await getDocs(collection(db, "posts"));

  let postCount = 0;
  let totalReactions = 0;

  const userPostsDiv = document.getElementById("userPosts");
  userPostsDiv.innerHTML = "";

  postsSnapshot.forEach((docSnap) => {
    const data = docSnap.data();

    if (data.userId === user.uid) {
      postCount++;

      totalReactions += (data.likes || 0) +
                        (data.love || 0) +
                        (data.sad || 0);

      userPostsDiv.innerHTML += `
        <div class="card post-card p-3 mb-3 shadow-sm border-0">
          ${data.text}
        </div>
      `;
    }
  });

  document.getElementById("postCount").innerText = postCount;
  document.getElementById("reactionCount").innerText = totalReactions;
});
window.logout = async function() {
  await signOut(auth);
  window.location.href = "login.html";
};
</script>

</body>
</html>